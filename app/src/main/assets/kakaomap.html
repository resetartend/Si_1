<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Kakao Map</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
        #map {
            width: 100%;
            height: 100%;
            display: block;
        }
    </style>
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=5091884dcaa812aa2e13f8ee3448f154&autoload=false"></script>
    <script>
        let map;
        let polyline; // ì´ì „ polyline ì €ì¥ìš©
        let startMarker, endMarker, userMarker; // ì‹œì‘ ë§ˆì»¤, ë ë§ˆì»¤, ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤

        kakao.maps.load(function () {
            const container = document.getElementById('map');
            const options = {
                center: new kakao.maps.LatLng(37.379974, 126.803710), // ì˜¤ì´ë„ ê±°ë¶ì„¬ ê·¼ì²˜
                level: 4
            };
            map = new kakao.maps.Map(container, options);

            // ì‚¬ìš©ìì˜ í˜„ì¬ ìœ„ì¹˜ í‘œì‹œ
            showCurrentLocation();

            // ì½”ìŠ¤ ì •ë³´ë¥¼ URLì—ì„œ ê°€ì ¸ì˜¤ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const course = urlParams.get('courseCoords');
            if (course) {
                showSelectedCourse(course);
            }
        });

        // ì‚¬ìš©ìì˜ í˜„ì¬ ìœ„ì¹˜ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function showCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        const loc = new kakao.maps.LatLng(lat, lon);

                        // ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤
                        if (userMarker) userMarker.setMap(null);
                        userMarker = new kakao.maps.Marker({
                            map: map,
                            position: loc,
                            title: "ë‚´ ìœ„ì¹˜"
                        });

                        map.setCenter(loc); // ì§€ë„ ì¤‘ì‹¬ì„ ì‚¬ìš©ìì˜ ìœ„ì¹˜ë¡œ ì„¤ì •
                    },
                    function () {
                        alert("ğŸ“ ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    }
                );
            }
        }

        // ì½”ìŠ¤ë¥¼ ê·¸ë¦¬ëŠ” í•¨ìˆ˜
        function drawCourse(coursePath) {
            if (!map) return;

            if (polyline) polyline.setMap(null);
            if (startMarker) startMarker.setMap(null);
            if (endMarker) endMarker.setMap(null);

            map.setCenter(coursePath[Math.floor(coursePath.length / 2)]);

            polyline = new kakao.maps.Polyline({
                map: map,
                path: coursePath,
                strokeWeight: 5,
                strokeColor: '#FF0000',
                strokeOpacity: 0.9,
                strokeStyle: 'solid'
            });

            // ì‹œì‘ ì§€ì  ë§ˆì»¤
            startMarker = new kakao.maps.Marker({
                map: map,
                position: coursePath[0],
                title: 'ì‹œì‘ ì§€ì '
            });

            // ë ì§€ì  ë§ˆì»¤
            endMarker = new kakao.maps.Marker({
                map: map,
                position: coursePath[coursePath.length - 1],
                title: 'ë ì§€ì '
            });
        }

        function setCourse1() {
            const course1 = [
                new kakao.maps.LatLng(37.329172, 126.671652),
                new kakao.maps.LatLng(37.320251, 126.685087),
                new kakao.maps.LatLng(37.318932, 126.691715),
                new kakao.maps.LatLng(37.316412, 126.699271)
            ];
            drawCourse(course1);
        }

        function setCourse2() {
            const course2 = [
                new kakao.maps.LatLng(37.319418, 126.680423),
                new kakao.maps.LatLng(37.329172, 126.671652),
                new kakao.maps.LatLng(37.335058, 126.690893),
            ];
            drawCourse(course2);
        }

        function setCourse3() {
            const course3 = [
                new kakao.maps.LatLng(37.354057, 126.702404),
                new kakao.maps.LatLng(37.372510, 126.721673)
            ];
            drawCourse(course3);
        }

        function setCourse4() {
            const course4 = [
                new kakao.maps.LatLng(37.355584, 126.712390),
                new kakao.maps.LatLng(37.340206, 126.733561)
            ];
            drawCourse(course4);
        }

        function setCourse5() {
            const course5 = [
                new kakao.maps.LatLng(37.354670, 126.715296),
                new kakao.maps.LatLng(37.333719, 126.749093)
            ];
            drawCourse(course5);
        }

        function setCourse6() {
            const course6 = [
                new kakao.maps.LatLng(37.349066, 126.735422),
                new kakao.maps.LatLng(37.336848, 126.753012),
                new kakao.maps.LatLng(37.339831, 126.757507)
            ];
            drawCourse(course6);
        }

        function showSelectedCourse(course) {
            if (course === "ì½”ìŠ¤1") {
                setCourse1();
            } else if (course === "ì½”ìŠ¤2") {
                setCourse2();
            } else if (course === "ì½”ìŠ¤3") {
                setCourse3();
            } else if (course === "ì½”ìŠ¤4") {
                setCourse4();
            } else if (course === "ì½”ìŠ¤5") {
                setCourse5();
            } else if (course === "ì½”ìŠ¤6") {
                setCourse6();
            }
        }
    </script>
</head>
<body>
<div id="map"></div>
</body>
</html>
